directive duration 100 points 1000
directive simulation deterministicstiff
directive concentration M
directive compilation infinite
directive plot A(); B(); C(); D(); E(); F()

(* Input and output *)
def Signal(unk, i1, i2, i3) = <unk i1^ i2 i3^>

(* Unimolecular to one product reaction *)
def G_1(ia, ib, ic, unko1, o1a) = {ia^*}[ib ic^]<unko1 o1a^>
def T_1(ic, unko, oa, ob, oc) = {ic^*}[unko oa^]<ob oc^>

(* Intermediate states *)
def Waste1_uni(unki, ia, ib, ic) = <unki>[ia^ ib ic^]
def Waste2_1(ib, ic, unko, oa) = <ib>[ic^ unko oa^]
def P_1(ib, ic, unko, oa) = <ib ic^ unko oa^>

def A_e_B(
    qi, qmax, CiA, CiB, Cmax,
    unki, ia, ib, ic,
    unko, oa, ob, oc
) = (
      CiA  * Signal(unki, ia, ib, ic)
    | CiB  * Signal(unko, oa, ob, oc)
    | Cmax * G_1(ia, ib, ic, unko, oa)
    | Cmax * T_1(ic, unko, oa, ob, oc)
    | rxn Signal(unki, ia, ib, ic) + G_1(ia, ib, ic, unko, oa) ->{qi} Waste1_uni(unki, ia, ib, ic) + P_1(ib, ic, unko, oa)
    | rxn P_1(ib, ic, unko, oa) + T_1(ic, unko, oa, ob, oc) ->{qmax} Waste2_1(ib, ic, unko, oa) + Signal(unko, oa, ob, oc)
)

(* Unimolecular to two products reaction *)
def G_2(ia, ib, ic, unko1, o1a, unko2, o2a) = {ia^*}[ib ic^]<unko1 o1a^ unko2 o2a^>
def T_2(ic, unko1, o1a, o1b, o1c, unko2, o2a, o2b, o2c) = {ic^*}[unko1 o1a^]<o1b o1c^>:[unko2 o2a^]<o2b o2c^>

(* Intermediate states *)
def Waste2_2(ib, ic, unko1, o1a, unko2, o2a) = <ib>[ic^ unko1 o1a^ unko2 o2a^]
def P_2(ib, ic, unko1, o1a, unko2, o2a) = <ib ic^ unko1 o1a^ unko2 o2a^>

def A_e_BpC(
    qi, qmax, CiA, CiB, CiC, Cmax,
    unki, ia, ib, ic,
    unko1, o1a, o1b, o1c,
    unko2, o2a, o2b, o2c
) = (
      CiA  * Signal(unki, ia, ib, ic)
    | CiB  * Signal(unko1, o1a, o1b, o1c)
    | CiC  * Signal(unko2, o2a, o2b, o2c)
    | Cmax * G_2(ia, ib, ic, unko1, o1a, unko2, o2a)
    | Cmax * T_2(ic, unko1, o1a, o1b, o1c, unko2, o2a, o2b, o2c)
    | rxn Signal(unki, ia, ib, ic) + G_2(ia, ib, ic, unko1, o1a, unko2, o2a) ->{qi} Waste1_uni(unki, ia, ib, ic) + P_2(ib, ic, unko1, o1a, unko2, o2a)
    | rxn P_2(ib, ic, unko1, o1a, unko2, o2a) + T_2(ic, unko1, o1a, o1b, o1c, unko2, o2a, o2b, o2c) ->{qmax} Waste2_2(ib, ic, unko1, o1a, unko2, o2a) + Signal(unko1, o1a, o1b, o1c) + Signal(unko2, o2a, o2b, o2c)
)

(* Bimolecular to one product reaction *)
def L_1(i1a, i1b, i1c, i2a, i2b, i2c, unko, oa) = {i1a^*}[i1b i1c^ i2a^]:[i2b i2c^]<unko oa^>
def W(i1b, i1c, i2a) = <i1b i1c^ i2a^>

(* Intermediate states *)
def H_1(unki1, i1a, i1b, i1c, i2a, i2b, i2c, unko, oa) = <unki1>[i1a^ i1b i1c^]:{i2a^*}[i2b i2c^]<unko oa^>
def Waste1_bi(unki1, unki2, i1a, i1b, i1c, i2a, i2b, i2c) = <unki1>[i1a^ i1b i1c^]:<unki2>[i2a^ i2b i2c^]

def ApB_e_C(
    qi, qmax, CiA, CiB, CiC, Cmax,
    unka, i1a, i1b, i1c,
    unkb, i2a, i2b, i2c,
    unkc, c1, c2, c3
) = (
      CiA  * Signal(unka, i1a, i1b, i1c)
    | CiB  * Signal(unkb, i2a, i2b, i2c)
    | CiC  * Signal(unkc, c1, c2, c3)
    | Cmax * L_1(i1a, i1b, i1c, i2a, i2b, i2c, unkc, c1)
    | Cmax * W(i1b, i1c, i2a)
    | Cmax * T_1(i2c, unkc, c1, c2 ,c3)
    | rxn Signal(unka, i1a, i1b, i1c) + L_1(i1a, i1b, i1c, i2a, i2b, i2c, unkc, c1) <->{qi}{qmax} H_1(unka, i1a, i1b, i1c, i2a, i2b, i2c, unkc, c1) + W(i1b, i1c, i2a)
    | rxn Signal(unkb, i2a, i2b, i2c) + H_1(unka, i1a, i1b, i1c, i2a, i2b, i2c, unkc, c1) ->{qmax} Waste1_bi(unka, unkb, i1a, i1b, i1c, i2a, i2b, i2c) + P_1(ib, ic, unkc, c1)
    | rxn P_1(ib, ic, unkc, c1) + T_1(i2c, unkc, c1, c2 ,c3) ->{qmax} Waste2_1(i2b, i2c, unkc, c1) + Signal(unkc, c1, c2, c3)
)

(* Bimolecular to two products reaction *)
def L_2(i1a, i1b, i1c, i2a, i2b, i2c, unko1, o1a, unko2, o2a) = {i1a^*}[i1b i1c^ i2a^]:[i2b i2c^]<unko1 o1a^ unko2 o2a^>

(* Intermediate states *)
def H_2(unki1, i1a, i1b, i1c, i2a, i2b, i2c, unko1, o1a, unko2, o2a) = <unki1>[i1a^ i1b i1c^]:{i2a^*}[i2b i2c^]<unko1 o1a^ unko2 o2a^>

def ApB_e_CpD(
    qi, qmax, CiA, CiB, CiC, CiD, Cmax,
    unka, i1a, i1b, i1c,
    unkb, i2a, i2b, i2c,
    unkc, o1a, o1b, o1c,
    unkd, o2a, o2b, o2c
) = (
      CiA  * Signal(unka, i1a, i1b, i1c)
    | CiB  * Signal(unkb, i2a, i2b, i2c)
    | CiC  * Signal(unkc, o1a, o1b, o1c)
    | CiD  * Signal(unkd, o2a, o2b, o2c)
    | Cmax * L_2(i1a, i1b, i1c, i2a, i2b, i2c, unkc, o1a, unkd, o2a)
    | Cmax * W(i1b, i1c, i2a)
    | Cmax * T_2(i2c, unkc, o1a, o1b, o1c, unkd, o2a, o2b, o2c)
    | rxn Signal(unka, i1a, i1b, i1c) + L_2(i1a, i1b, i1c, i2a, i2b, i2c, unkc, o1a, unkd, o2a) <->{qi}{qmax} H_2(unka, i1a, i1b, i1c, i2a, i2b, i2c, unkc, o1a, unkd, o2a) + W(i1b, i1c, i2a)
    | rxn Signal(unkb, i2a, i2b, i2c) + H_2(unka, i1a, i1b, i1c, i2a, i2b, i2c, unkc, o1a, unkd, o2a) ->{qmax} Waste1_bi(unka, unkb, i1a, i1b, i1c, i2a, i2b, i2c) + P_2(i2b, i2c, unkc, o1a, unkd, o2a)
    | rxn P_2(i2b, i2c, unkc, o1a, unkd, o2a) + T_2(i2c, unkc, o1a, o1b, o1c, unkd, o2a, o2b, o2c) ->{qmax} Waste2_2(i2b, i2c, unkc, o1a, unkd, o2a) + Signal(unkc, o1a, o1b, o1c) + Signal(unkd, o2a, o2b, o2c)
)

(* Buffer module *)
def LS(ia, ib, ic, d) = {ia^*}[ib ic^ d^]
def BS(ib, ic, d) = <ib ic^ d^>

(* Intermediate states *)
def HS(unki, ia, ib, ic, d) = <unki>[ia^ ib ic^]{d^*}

def Buff(
    qs, qmax, Cmax, Cii, d,
    unki, ia, ib, ic
) = (
      Cii * Signal(unki, ia, ib, ic)
    | Cmax * LS(ia, ib, ic, d)
    | Cmax * BS(ib, ic, d)
    | rxn Signal(unki, ia, ib, ic) + LS(ia, ib, ic, d) <->{qs}{qmax} HS(unki, ia, ib, ic, d) + BS(ib, ic, d)
)

(* Degradation reactions *)
def A_e_0(qi, CiA, Cmax, unki, ia, ib, ic) = new unko new oa (
      CiA  * Signal(unki, ia, ib, ic)
    | Cmax * G_1(ia, ib, ic, unko, oa)
    | rxn Signal(unki, ia, ib, ic) + G_1(ia, ib, ic, unko, oa) ->{qi} Waste1_uni(unki, ia, ib, ic) + P_1(ib, ic, unko, oa)
)

def ApB_e_0(
    qi, qmax, CiA, CiB, Cmax,
    unka, i1a, i1b, i1c,
    unkb, i2a, i2b, i2c
) = new unko new oa (
      CiA  * Signal(unka, i1a, i1b, i1c)
    | CiB  * Signal(unkb, i2a, i2b, i2c)
    | Cmax * L_1(i1a, i1b, i1c, i2a, i2b, i2c, unko, oa)
    | Cmax * W(i1b, i1c, i2a)
    | rxn Signal(unka, i1a, i1b, i1c) + L_1(i1a, i1b, i1c, i2a, i2b, i2c, unko, oa) <->{qi}{qmax} H_1(unka, i1a, i1b, i1c, i2a, i2b, i2c, unko, oa) + W(i1b, i1c, i2a)
    | rxn Signal(unkb, i2a, i2b, i2c) + H_1(unka, i1a, i1b, i1c, i2a, i2b, i2c, unko, oa) ->{qmax} Waste1_bi(unka, unkb, i1a, i1b, i1c, i2a, i2b, i2c) + P_1(ib, ic, unko, oa)
)

(* Formation reactions *)
(* These reaction get unstable when G_1 or G_2 run out *)
def r0_e_A(
    qi, qmax, CiA, Cmax,
    unko, oa, ob, oc
) = new unki new ia new ib new ic (
      CiA  * Signal(unko, oa, ob, oc)
    | Cmax * G_1(ia, ib, ic, unko, oa)
    | Cmax * T_1(ic, unko, oa, ob, oc)
    | rxn G_1(ia, ib, ic, unko, oa) ->{qi} Waste1_uni(unki, ia, ib, ic) + P_1(ib, ic, unko, oa)
    | rxn P_1(ib, ic, unko, oa) + T_1(ic, unko, oa, ob, oc) ->{qmax} Waste2_1(ib, ic, unko, oa) + Signal(unko, oa, ob, oc)
)

def r0_e_ApB(
    qi, qmax, CiA, CiB, Cmax,
    unko1, o1a, o1b, o1c,
    unko2, o2a, o2b, o2c
) = new unki new ia new ib new ic (
      CiA  * Signal(unko1, o1a, o1b, o1c)
    | CiB  * Signal(unko2, o2a, o2b, o2c)
    | Cmax * G_2(ia, ib, ic, unko1, o1a, unko2, o2a)
    | Cmax * T_2(ic, unko1, o1a, o1b, o1c, unko2, o2a, o2b, o2c)
    | rxn G_2(ia, ib, ic, unko1, o1a, unko2, o2a) ->{qi} Waste1_uni(unki, ia, ib, ic) + P_2(ib, ic, unko1, o1a, unko2, o2a)
    | rxn P_2(ib, ic, unko1, o1a, unko2, o2a) + T_2(ic, unko1, o1a, o1b, o1c, unko2, o2a, o2b, o2c) ->{qmax} Waste2_2(ib, ic, unko1, o1a, unko2, o2a) + Signal(unko1, o1a, o1b, o1c) + Signal(unko2, o2a, o2b, o2c)
)


def Cmax = 1e+06
def qmax = 10000
def CiA = 1000.0
def CiB = 0.0
def CiC = 1000.0
def CiD = 1000.0
def CiE = 1000.0
def CiF = 0.0

def k1 = 1.00000001e-06
def k2 = 2.00000002e-06
def k3 = 0.000100000001
def k4 = 0.000100000001
def k5 = 2.00000002e-06
def kb1 = 0.000100000001

def A() = (Signal(d1, d2, d3, d4))
def B() = (Signal(d5, d6, d7, d8))
def C() = (Signal(d9, d10, d11, d12))
def D() = (Signal(d13, d14, d15, d16))
def E() = (Signal(d17, d18, d19, d20))
def F() = (Signal(d21, d22, d23, d24))


def CiA = CiA/2.0
def CiB = CiB/1.0
def CiC = CiC/2.0
def CiD = CiD/1.0
def CiE = CiE/1.0
def CiF = CiF/2.0

(

A_e_0(
    k1, CiA, Cmax, d1, d2, d3, d4
) |
r0_e_A(
    k2, qmax, CiB, Cmax, d5, d6, d7, d8
) |
ApB_e_0(
    k3, qmax, CiC, CiC, Cmax,
    d9, d10, d11, d12,
    d9, d10, d11, d12
) |
ApB_e_0(
    k4, qmax, CiD, CiE, Cmax,
    d13, d14, d15, d16,
    d17, d18, d19, d20
) |
r0_e_ApB(
    k5, qmax, CiF, CiF, Cmax,
    d21, d22, d23, d24,
    d21, d22, d23, d24
) |
Buff(
    kb1, qmax, Cmax, CiA, d25,
    d1, d2, d3, d4
)

)
